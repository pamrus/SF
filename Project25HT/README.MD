# Модуль 25. Взаимодействие C++ кода и БД.
# 25.7. Итоговое задание
 
ЗАДАЧА: 
Теперь вы готовы доработать чат и можете организовать хранение данных чата в базе данных.
Есть два основных способа реализации. Вам надо реализовать один из них или придумать и реализовать свой собственный.


1. Традиционный способ — это использование архитектуры клиент-сервер. В этом случае хранение всех данных происходит в базе данных на сервере.
Клиенту при своём старте необходимо связаться с сервером по IP-адресу сервера и порту, зарегистрироваться на нём, передав ему свой логин и пароль.
Если регистрация прошла успешно, то сервер в ответ высылает список пользователей и историю сообщений. Основным достоинством этой архитектуры является то, 
что все данные хранятся в одном месте, и так проще и надёжнее можно организовать целостность базы данных и синхронизацию данных между различными клиентами.
2. Второй способ — это чат с децентрализованной (peer-to-peer, P2P — равный к равному) моделью соединения. 
3. В этом случае каждый клиент должен иметь собственную базу данных, т.е. каждая программа с чатом является как клиентом, так и выполняет функции сервера.
Основным плюсом такого решения — является то, что клиенты могут взаимодействовать друг с другом без сервера, 
главным же недостатком является сложность синхронизации данных между различными клиентами, для этой цели потребуются специальные сообщения между всеми клиентами чата.


## Взаимодействие с БД MySQL:

Выбрана архитектура клиент-сервер, взаимодействие с базой данных через *MySQL API* с помощью четырёх классов, работающих на разных уровнях абстракции. 
`mySQL_API_database` отвечает за подключение к MySQL-серверу и определение и освобождение хендла.
`mySQL_API_table` - универсальный класс, обеспечивающий отправку запросов и чтение ответов БД.
Его потомки `mySQL_API_usersTable` и `mySQL_API_messagesTable` реализуют высокоуровневые запросы для бизнес-логики.


## Сетевое взаимодействие:

Заготовка сетевого обмена реализована с использованием библиотеки Boost.Asio по протоколу TCP.
За основу были взяты примеры из [github.com/Vasilui/...](https://github.com/Vasilui/habrahabr/tree/master/Boost.Asio_C%2B%2B_Network_Programming/Chapter_4).  
> Логика работы сервера:  
>> - поиск базы данных с именем *'chat'* и создание при отсутствии, подключение к ней,  
>> - DDL-функционал: проверка структуры существующих таблиц / их создание,  
>> - ожидание подключения клиента, после подключения - ожидание следующего.  
> Логика работы клиента:  
>> - подключение к серверу,  
>> - запрос на действие пользователя (регистрация или вход),  
>> - при успешном входе запрашиваются непрочитанные сообщения,  
>> - далее в бесконечном цикле принимаются новые сообщения для других пользователей.  


## Нерешённые проблемы:

> 1. корректный выход из клиента/сервера - не реализован,  
> 2. удобная логика взаимодействия с пользователем (на машине состояний, как было ранее) - не реализована,  
> 3. сообщения не должны содержать пробелов,  
> 4. сборка под Linux в определённый момент 'сломалась'.  


## Настройки проекта в Microsoft Visual Studio:

> 1. "C/C++" -> "Общие" -> "Дополнительные каталоги включаемых файлов": добавить `c:\mysql\include; c:\Program Files\boost_1_78_0\`  
> 2. "C/C++" -> "Создание кода" -> "Библиотека времени выполнения": изменить на `/MTd`  
> 3. "C/C++" -> "Препроцессор" -> "Определения препроцессора": добавить `_WIN32_WINNT=0x0601`  
> 4. "Компоновщик" -> "Общие" -> "Дополнительные каталоги библиотек": добавить `c:\mysql\lib; c:\Program Files\boost_1_78_0\stage\lib\`  
> 5. "Компоновщик" -> "Командная строка": добавить `/FORCE:MULTIPLE`  


Решение: Александр Павлинов 2022.02.17
